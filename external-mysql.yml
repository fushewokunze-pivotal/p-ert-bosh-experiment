#remove all mysql instance groups
- type: remove
  path: /instance_groups/name=mysql

- type: remove
  path: /instance_groups/name=mysql_monitor

- type: remove
  path: /instance_groups/name=mysql_proxy


#replace database configuration
- type: replace
  path: /instance_groups/name=diego-bbs/jobs/name=bbs/properties/diego/bbs/sql
  value:
    db_host: ((external_mysql_host))
    db_port: ((external_mysql_port))
    db_schema: diego
    db_username: ((external_mysql_username))
    db_password: ((external_mysql_password))
    db_driver: mysql

- type: replace
  path: /instance_groups/name=uaa/jobs/name=uaa/properties/uaadb
  value:
    address: ((external_mysql_host))
    databases:
    - name: uaa
      tag: uaa
    db_scheme: mysql
    port: ((external_mysql_port))
    roles:
    - name: ((external_mysql_username))
      password: ((external_mysql_password))
      tag: admin

- type: replace
  path: /instance_groups/name=api/jobs/name=cloud_controller_ng/properties/ccdb
  value: &ccdb
    databases:
    - name: cloud_controller
      tag: cc
    address: ((external_mysql_host))
    db_scheme: mysql
    port: ((external_mysql_port))
    roles:
    - name: ((external_mysql_username))
      password: ((external_mysql_password))
      tag: admin

- type: replace
  path: /instance_groups/name=api/jobs/name=cloud_controller_worker/properties/ccdb
  value: *ccdb

- type: replace
  path: /instance_groups/name=cc_clock/jobs/name=cloud_controller_clock/properties/ccdb
  value: *ccdb

- type: replace
  path: /instance_groups/name=push-apps-manager/jobs/name=push-apps-manager/properties/databases/app_usage_service
  value:
    name: app_usage_service
    port: ((external_mysql_port))
    ip: ((external_mysql_host))
    username: ((external_mysql_username))
    password: ((external_mysql_password))